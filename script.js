// ==================== –î–ê–ù–ù–´–ï –ö–ï–ô–°–û–í ====================
// –¶–µ–Ω—ã —É–∫–∞–∑–∞–Ω—ã –≤ USD (–±–∞–∑–æ–≤–∞—è –≤–∞–ª—é—Ç–∞)

const casesData = {
    "Gamma Case": {
        name: "–ö–µ–π—Å ¬´–ì–∞–º–º–∞¬ª",
        price: 2.49,
        image: "img/Gamma Case/Gamma Case.png",
        items: [
            { name: "MAC-10 Carnivore", image: "img/Gamma Case/item Gamma Case/MAC-10 Carnivore.png", rarity: "consumer", price: 0.024 },
            { name: "Nova Exo", image: "img/Gamma Case/item Gamma Case/Nova Exo.png", rarity: "consumer", price: 0.024 },
            { name: "Sawed-Off Limelight", image: "img/Gamma Case/item Gamma Case/Sawed-Off Limelight.png", rarity: "consumer", price: 0.024 },
            { name: "PP-Bizon Harvester", image: "img/Gamma Case/item Gamma Case/PP-Bizon Harvester.png", rarity: "industrial", price: 0.08 },
            { name: "Tec-9 Ice Cap", image: "img/Gamma Case/item Gamma Case/Tec-9 Ice Cap.png", rarity: "industrial", price: 0.08 },
            { name: "P250 Iron Clad", image: "img/Gamma Case/item Gamma Case/P250 Iron Clad.png", rarity: "industrial", price: 0.08 },
            { name: "SG 553 Aerial", image: "img/Gamma Case/item Gamma Case/SG 553 Aerial.png", rarity: "mil-spec", price: 2.20 },
            { name: "Five-SeveN Violent Daimyo", image: "img/Gamma Case/item Gamma Case/Five-SeveN Violent Daimyo.png", rarity: "mil-spec", price: 2.80 },
            { name: "P90 Chopper", image: "img/Gamma Case/item Gamma Case/P90 Chopper.png", rarity: "mil-spec", price: 3.10 },
            { name: "R8 Revolver Reboot", image: "img/Gamma Case/item Gamma Case/R8 Revolver Reboot.png", rarity: "mil-spec", price: 2.50 },
            { name: "AUG Aristocrat", image: "img/Gamma Case/item Gamma Case/AUG Aristocrat.png", rarity: "restricted", price: 5.50 },
            { name: "P2000 Imperial Dragon", image: "img/Gamma Case/item Gamma Case/P2000 Imperial Dragon.png", rarity: "restricted", price: 7.00 },
            { name: "AWP Phobos", image: "img/Gamma Case/item Gamma Case/AWP Phobos.png", rarity: "restricted", price: 8.50 },
            { name: "SCAR-20 Bloodsport", image: "img/Gamma Case/item Gamma Case/SCAR-20 Bloodsport.png", rarity: "classified", price: 15.00 },
            { name: "Glock-18 Wasteland Rebel", image: "img/Gamma Case/item Gamma Case/Glock-18 Wasteland Rebel.png", rarity: "classified", price: 22.00 },
            { name: "M4A1-S Mecha Industries", image: "img/Gamma Case/item Gamma Case/M4A1-S Mecha Industries.png", rarity: "covert", price: 65.00 },
            { name: "M4A4 Desolate Space", image: "img/Gamma Case/item Gamma Case/M4A4 Desolate Space.png", rarity: "covert", price: 55.00 },
            { name: "‚òÖ Karambit Gamma Doppler Emerald", image: "img/Gamma Case/item Gamma Case/‚òÖ Karambit Gamma Doppler Emerald.png", rarity: "rare", price: 55000.00 }
        ]
    },
    "Kilowatt Case": {
        name: "–ö–µ–π—Å ¬´–ö–∏–ª–æ–≤–∞—Ç—Ç¬ª",
        price: 3.99,
        image: "img/Kilowatt Case/Kilowatt Case.png",
        items: [
            { name: "MAC-10 Light Box", image: "img/Kilowatt Case/item Kilowatt Case/MAC-10 Light Box.png", rarity: "consumer", price: 0.024 },
            { name: "Nova Dark Sigil", image: "img/Kilowatt Case/item Kilowatt Case/Nova Dark Sigil.png", rarity: "consumer", price: 0.95 },
            { name: "SSG 08 Dezastre", image: "img/Kilowatt Case/item Kilowatt Case/SSG 08 Dezastre.png", rarity: "consumer", price: 0.85 },
            { name: "Tec-9 Slag", image: "img/Kilowatt Case/item Kilowatt Case/Tec-9 Slag.png", rarity: "industrial", price: 1.80 },
            { name: "Sawed-Off Analog Input", image: "img/Kilowatt Case/item Kilowatt Case/Sawed-Off Analog Input.png", rarity: "industrial", price: 1.50 },
            { name: "Five-SeveN Hybrid", image: "img/Kilowatt Case/item Kilowatt Case/Five-SeveN Hybrid.png", rarity: "industrial", price: 1.65 },
            { name: "UMP-45 Motorized", image: "img/Kilowatt Case/item Kilowatt Case/UMP-45 Motorized.png", rarity: "mil-spec", price: 3.50 },
            { name: "MP7 Just Smile", image: "img/Kilowatt Case/item Kilowatt Case/MP7 Just Smile.png", rarity: "mil-spec", price: 4.20 },
            { name: "XM1014 Irezumi", image: "img/Kilowatt Case/item Kilowatt Case/XM1014 Irezumi.png", rarity: "mil-spec", price: 3.20 },
            { name: "Zeus x27 Olympus", image: "img/Kilowatt Case/item Kilowatt Case/Zeus x27 Olympus.png", rarity: "mil-spec", price: 4.80 },
            { name: "USP-S Jawbreaker", image: "img/Kilowatt Case/item Kilowatt Case/USP-S Jawbreaker.png", rarity: "restricted", price: 9.50 },
            { name: "M4A4 Etch Lord", image: "img/Kilowatt Case/item Kilowatt Case/M4A4 Etch Lord.png", rarity: "restricted", price: 12.00 },
            { name: "Glock-18 Block-18", image: "img/Kilowatt Case/item Kilowatt Case/Glock-18 Block-18.png", rarity: "restricted", price: 10.50 },
            { name: "AWP Chrome Cannon", image: "img/Kilowatt Case/item Kilowatt Case/AWP Chrome Cannon.png", rarity: "classified", price: 35.00 },
            { name: "M4A1-S Black Lotus", image: "img/Kilowatt Case/item Kilowatt Case/M4A1-S Black Lotus.png", rarity: "classified", price: 48.00 },
            { name: "AK-47 Inheritance", image: "img/Kilowatt Case/item Kilowatt Case/AK-47 Inheritance.png", rarity: "covert", price: 150.00 },
            { name: "‚òÖ Kukri Knife Fade", image: "img/Kilowatt Case/item Kilowatt Case/‚òÖ Kukri Knife Fade.png", rarity: "rare", price: 1800.00 }
        ]
    },
    "Revolution Case": {
        name: "–ö–µ–π—Å ¬´–†–µ–≤–æ–ª—é—Ü–∏—è¬ª",
        price: 2.99,
        image: "img/Revolution Case/Revolution Case.png",
        items: [
            { name: "MP9 Featherweight", image: "img/Revolution Case/item Revolution Case/MP9 Featherweight.png", rarity: "consumer", price: 0.024 },
            { name: "MAG-7 Insomnia", image: "img/Revolution Case/item Revolution Case/MAG-7 Insomnia.png", rarity: "consumer", price: 0.024 },
            { name: "MP5-SD Liquidation", image: "img/Revolution Case/item Revolution Case/MP5-SD Liquidation.png", rarity: "consumer", price: 0.024 },
            { name: "Tec-9 Rebel", image: "img/Revolution Case/item Revolution Case/Tec-9 Rebel.png", rarity: "industrial", price: 0.08 },
            { name: "P250 Re.built", image: "img/Revolution Case/item Revolution Case/P250 Re.built.png", rarity: "industrial", price: 0.08 },
            { name: "SCAR-20 Fragments", image: "img/Revolution Case/item Revolution Case/SCAR-20 Fragments.png", rarity: "industrial", price: 0.08 },
            { name: "SG 553 Cyberforce", image: "img/Revolution Case/item Revolution Case/SG 553 Cyberforce.png", rarity: "mil-spec", price: 0.15 },
            { name: "MAC-10 Sakkaku", image: "img/Revolution Case/item Revolution Case/MAC-10 Sakkaku.png", rarity: "mil-spec", price: 0.15 },
            { name: "UMP-45 Wild Child", image: "img/Revolution Case/item Revolution Case/UMP-45 Wild Child.png", rarity: "mil-spec", price: 0.15 },
            { name: "R8 Revolver Banana Cannon", image: "img/Revolution Case/item Revolution Case/R8 Revolver Banana Cannon.png", rarity: "mil-spec", price: 0.15 },
            { name: "P2000 Wicked Sick", image: "img/Revolution Case/item Revolution Case/P2000 Wicked Sick.png", rarity: "restricted", price: 0.5 },
            { name: "Glock-18 Umbral Rabbit", image: "img/Revolution Case/item Revolution Case/Glock-18 Umbral Rabbit.png", rarity: "restricted", price: 0.5 },
            { name: "P90 Neoqueen", image: "img/Revolution Case/item Revolution Case/P90 Neoqueen.png", rarity: "restricted", price: 0.5 },
            { name: "M4A4 Temukau", image: "img/Revolution Case/item Revolution Case/M4A4 Temukau.png", rarity: "classified", price: 4.5 },
            { name: "M4A1-S Emphorosaur-S", image: "img/Revolution Case/item Revolution Case/M4A1-S Emphorosaur-S.png", rarity: "classified", price: 5 },
            { name: "AK-47 Head Shot", image: "img/Revolution Case/item Revolution Case/AK-47 Head Shot.png", rarity: "covert", price: 30 },
            { name: "AWP Duality", image: "img/Revolution Case/item Revolution Case/AWP Duality.png", rarity: "covert", price: 40 },
            { name: "‚òÖ Sport Gloves Amphibious", image: "img/Revolution Case/item Revolution Case/‚òÖ Sport Gloves Amphibious.png", rarity: "rare", price: 250 }
        ]
    },
    "eSports –°ase": {
        name: "–ö–µ–π—Å ¬´eSports 2013¬ª",
        price: 15.45,
        image: "img/eSports 2013 Case/eSports –°ase.png",
        items: [
            { name: "MP9 Featherweight", image: "img/Revolution Case/item Revolution Case/MP9 Featherweight.png", rarity: "consumer", price: 0.75 },
            { name: "MAG-7 Insomnia", image: "img/Revolution Case/item Revolution Case/MAG-7 Insomnia.png", rarity: "consumer", price: 0.60 },
            { name: "MP5-SD Liquidation", image: "img/Revolution Case/item Revolution Case/MP5-SD Liquidation.png", rarity: "consumer", price: 0.85 },
            { name: "Tec-9 Rebel", image: "img/Revolution Case/item Revolution Case/Tec-9 Rebel.png", rarity: "industrial", price: 1.40 },
            { name: "AWP Duality", image: "img/Revolution Case/item Revolution Case/AWP Duality.png", rarity: "covert", price: 125.00 },
            { name: "‚òÖ Karambit  Stained", image: "img/eSports 2013 Case/item eSports Case/‚òÖ Karambit  Stained.png", rarity: "rare", price: 37955.22 },
            { name: "‚òÖ Karambit Gamma Doppler Emerald", image: "img/Gamma Case/item Gamma Case/‚òÖ Karambit Gamma Doppler Emerald.png", rarity: "rare", price: 55000.00 },
            { name: "‚òÖ Karambit Gamma Doppler Emerald", image: "img/Gamma Case/item Gamma Case/‚òÖ Karambit Gamma Doppler Emerald.png", rarity: "rare", price: 55000.00 }
        ]
    }
};

// ==================== –ù–ê–°–¢–†–û–ô–ö–ò –í–ê–õ–Æ–¢ ====================

const currencies = {
    USD: { symbol: '$', rate: 1, name: 'USD' },
    EUR: { symbol: '‚Ç¨', rate: 0.86, name: 'EUR' },
    UAH: { symbol: '‚Ç¥', rate: 43.13, name: 'UAH' },
    JPY: { symbol: '¬•', rate: 158.36, name: 'JPY' },
    CNY: { symbol: '¬•', rate: 6.96, name: 'CNY' }
};

// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≥—Ä–∏–≤–Ω—ã
let currentCurrency = localStorage.getItem('cs2_currency') || 'UAH';

// ==================== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ====================

let stats = JSON.parse(localStorage.getItem('cs2_stats')) || {
    casesOpened: 0,
    moneySpent: 0,
    itemsSold: 0,
    moneyEarned: 0,
    rarityDrops: {
        consumer: 0,
        industrial: 0,
        'mil-spec': 0,
        restricted: 0,
        classified: 0,
        covert: 0,
        rare: 0
    }
};

// ==================== –°–û–°–¢–û–Ø–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ====================

const INITIAL_BALANCE_USD = 23;
let balance = parseFloat(localStorage.getItem('cs2_balance')) || INITIAL_BALANCE_USD;
let inventory = JSON.parse(localStorage.getItem('cs2_inventory')) || [];
let currentCase = null;
let wonItem = null;
let isSpinning = false;
let soundEnabled = localStorage.getItem('cs2_sound') !== 'false';

// ==================== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ====================

document.addEventListener('DOMContentLoaded', () => {
    updateCurrencyDisplay();
    updateBalance();
    updateInventory();
    renderCases();
    initSoundToggle();
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–µ–Ω—é –≤–∞–ª—é—Ç—ã –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    document.addEventListener('click', (e) => {
        if (!e.target.closest('.currency-selector')) {
            document.getElementById('currencyMenu').classList.remove('show');
        }
    });
});

// ==================== –í–ê–õ–Æ–¢–ê ====================

function formatPrice(priceUSD) {
    const currency = currencies[currentCurrency];
    const converted = priceUSD * currency.rate;
    
    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–æ —Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ–º
    const formattedNumber = formatLargeNumber(converted);
    
    if (currentCurrency === 'UAH' || currentCurrency === 'JPY' || currentCurrency === 'CNY') {
        
        return formattedNumber + currency.symbol;
    }
    return currency.symbol + formattedNumber;
}

function formatPriceNumber(priceUSD) {
    const currency = currencies[currentCurrency];
    const converted = priceUSD * currency.rate;
    
    if (currentCurrency === 'UAH' || currentCurrency === 'JPY' || currentCurrency === 'CNY') {
        
        return formatLargeNumber(converted, false);
    }
    return formatLargeNumber(converted, true);
}

// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª —Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è–º–∏
// –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª —Å —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è–º–∏ (K, M, B, T)
function formatLargeNumber(num, showDecimals = true) {
    // –ï—Å–ª–∏ —á–∏—Å–ª–æ –º–µ–Ω—å—à–µ 1000, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
    if (num < 1000) {
        if (showDecimals) {
            return num.toFixed(2);
        }
        return Math.round(num).toString();
    }
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—Ä–µ—Ñ–∏–∫—Å
    let divisor, suffix;
    
    if (num < 1000000) {
        // –¢—ã—Å—è—á–∏ (1K - 999K)
        divisor = 1000;
        suffix = 'K';
    } else if (num < 1000000000) {
        // –ú–∏–ª–ª–∏–æ–Ω—ã (1M - 999M)
        divisor = 1000000;
        suffix = 'M';
    } else if (num < 1000000000000) {
        // –ú–∏–ª–ª–∏–∞—Ä–¥—ã (1B - 999B)
        divisor = 1000000000;
        suffix = 'B';
    } else {
        // –¢—Ä–∏–ª–ª–∏–æ–Ω—ã –∏ –±–æ–ª—å—à–µ
        divisor = 1000000000000;
        suffix = 'T';
    }
    
    const divided = num / divisor;
    
    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–∫–æ–ª—å–∫–æ –∑–Ω–∞–∫–æ–≤ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
    if (divided >= 100) {
        // –î–ª—è —á–∏—Å–µ–ª >= 100 –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–µ–∑ –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö
        return Math.round(divided) + suffix;
    } else if (divided >= 10) {
        // –î–ª—è —á–∏—Å–µ–ª 10-99 –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 1 –∑–Ω–∞–∫ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
        return divided.toFixed(1) + suffix;
    } else {
        // –î–ª—è —á–∏—Å–µ–ª <10 –ø–æ–∫–∞–∑—ã–≤–∞–µ–º 2 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
        return divided.toFixed(2) + suffix;
    }
}

function toggleCurrencyMenu() {
    document.getElementById('currencyMenu').classList.toggle('show');
}

function setCurrency(currency) {
    currentCurrency = currency;
    localStorage.setItem('cs2_currency', currency);
    updateCurrencyDisplay();
    updateBalance();
    renderCases();
    renderInventory();
    updateStats();
    document.getElementById('currencyMenu').classList.remove('show');
    playSound('click');
}

function updateCurrencyDisplay() {
    const currency = currencies[currentCurrency];
    document.getElementById('currencySymbol').textContent = currency.symbol;
    document.getElementById('currentCurrency').textContent = currency.name;
}

// ==================== –†–ï–ù–î–ï–†–ò–ù–ì ====================

function renderCases() {
    const grid = document.getElementById('casesGrid');
    grid.innerHTML = '';

    Object.keys(casesData).forEach(caseKey => {
        const caseData = casesData[caseKey];
        const card = document.createElement('div');
        card.className = 'case-card';
        card.onclick = () => openCaseModal(caseKey);
        card.innerHTML = `
            <img src="${caseData.image}" alt="${caseData.name}">
            <h3>${caseData.name}</h3>
            <p class="price">${formatPrice(caseData.price)}</p>
            <span class="open-text">–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</span>
        `;
        grid.appendChild(card);
    });
}

function renderInventory() {
    const grid = document.getElementById('inventoryGrid');
    const empty = document.getElementById('emptyInventory');
    const countEl = document.getElementById('inventoryCount');
    const valueEl = document.getElementById('inventoryValue');

    countEl.textContent = inventory.length;

    if (inventory.length === 0) {
        grid.innerHTML = '';
        empty.classList.add('show');
        valueEl.textContent = formatPrice(0);
        return;
    }

    empty.classList.remove('show');
    
    let totalValue = 0;
    grid.innerHTML = '';

    inventory.forEach((item, index) => {
        totalValue += item.price;
        const div = document.createElement('div');
        div.className = `inventory-item ${item.rarity}`;
        div.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <h4 title="${item.name}">${item.name}</h4>
            <p class="item-price">${formatPrice(item.price)}</p>
            <button class="sell-item-btn" onclick="sellItem(${index})">–ü—Ä–æ–¥–∞—Ç—å</button>
        `;
        grid.appendChild(div);
    });

    valueEl.textContent = formatPrice(totalValue);
}

// ==================== –ù–ê–í–ò–ì–ê–¶–ò–Ø ====================

function showSection(section) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

    if (section === 'cases') {
        document.getElementById('casesSection').classList.add('active');
        document.querySelectorAll('.nav-btn')[0].classList.add('active');
    } else if (section === 'inventory') {
        document.getElementById('inventorySection').classList.add('active');
        document.querySelectorAll('.nav-btn')[1].classList.add('active');
        renderInventory();
    } else if (section === 'stats') {
        document.getElementById('statsSection').classList.add('active');
        document.querySelectorAll('.nav-btn')[2].classList.add('active');
        updateStats();
    }

    playSound('click');
}

// ==================== –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û ====================

function openCaseModal(caseKey) {
    currentCase = casesData[caseKey];
    currentCase.key = caseKey; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    
    const currency = currencies[currentCurrency];
    document.getElementById('modalCaseImage').src = currentCase.image;
    document.getElementById('modalCaseName').textContent = currentCase.name;
    document.getElementById('modalCasePrice').textContent = formatPriceNumber(currentCase.price);
    document.getElementById('modalCurrencySymbol').textContent = currency.symbol;

    // –†–µ–Ω–¥–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –∫–µ–π—Å–∞
    const contentsGrid = document.getElementById('contentsGrid');
    contentsGrid.innerHTML = '';
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —Ä–µ–¥–∫–æ—Å—Ç–∏
    const rarityOrder = ['consumer', 'industrial', 'mil-spec', 'restricted', 'classified', 'covert', 'rare'];
    const sortedItems = [...currentCase.items].sort((a, b) => 
        rarityOrder.indexOf(a.rarity) - rarityOrder.indexOf(b.rarity)
    );

    sortedItems.forEach(item => {
        const div = document.createElement('div');
        div.className = `content-item ${item.rarity}`;
        div.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <span class="item-name" title="${item.name}">${item.name}</span>
            <span class="item-price">${formatPrice(item.price)}</span>
        `;
        contentsGrid.appendChild(div);
    });

    // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è
    document.getElementById('rouletteContainer').classList.remove('show');
    document.getElementById('winDisplay').classList.remove('show');
    document.getElementById('caseContents').style.display = 'block';
    document.getElementById('openCaseBtn').disabled = false;
    document.getElementById('openCaseBtn').style.display = 'flex';
    document.getElementById('openCaseFastBtn').disabled = false;
    document.getElementById('openCaseFastBtn').style.display = 'flex';

    document.getElementById('caseModal').classList.add('show');
    playSound('click');
}

function closeModal() {
    if (isSpinning) return;
    
    // –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–∏–≥—Ä–∞–Ω–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –∏ –æ–Ω –µ—â—ë –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
    if (wonItem) {
        inventory.push({...wonItem, id: Date.now()});
        saveData();
        updateInventory();
        showNotification(`${wonItem.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!`, 'success');
    }
    
    document.getElementById('caseModal').classList.remove('show');
    currentCase = null;
    wonItem = null;
    playSound('click');
}

// ==================== –û–¢–ö–†–´–¢–ò–ï –ö–ï–ô–°–ê ====================

function openCase() {
    if (!currentCase || isSpinning) return;
    
    if (balance < currentCase.price) {
        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error');
        return;
    }

    // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
    balance -= currentCase.price;
    updateBalance();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    stats.casesOpened++;
    stats.moneySpent += currentCase.price;
    saveData();

    isSpinning = true;
    document.getElementById('openCaseBtn').disabled = true;
    document.getElementById('openCaseFastBtn').disabled = true;
    document.getElementById('caseContents').style.display = 'none';

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
    wonItem = determineWin();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–µ–¥–∫–æ—Å—Ç–∏
    stats.rarityDrops[wonItem.rarity]++;
    saveData();

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä—É–ª–µ—Ç–∫—É
    generateRoulette();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä—É–ª–µ—Ç–∫—É
    document.getElementById('rouletteContainer').classList.add('show');

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∏–∫–∞—é—â–∏–π –∑–≤—É–∫
    startSpinSound();

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    setTimeout(() => {
        spinRoulette();
    }, 100);
}

// –ë—ã—Å—Ç—Ä–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏
function openCaseFast() {
    if (!currentCase || isSpinning) return;
    
    if (balance < currentCase.price) {
        showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!', 'error');
        return;
    }

    // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å
    balance -= currentCase.price;
    updateBalance();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    stats.casesOpened++;
    stats.moneySpent += currentCase.price;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
    wonItem = determineWin();
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–µ–¥–∫–æ—Å—Ç–∏
    stats.rarityDrops[wonItem.rarity]++;
    saveData();

    // –°–∫—Ä—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–µ–π—Å–∞
    document.getElementById('caseContents').style.display = 'none';
    document.getElementById('openCaseBtn').style.display = 'none';
    document.getElementById('openCaseFastBtn').style.display = 'none';

    // –°—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    showWinResult();
    playSound('win');
}

function determineWin() {
    // –£–ª—É—á—à–µ–Ω–Ω—ã–µ —à–∞–Ω—Å—ã –Ω–∞ —Ä–µ–¥–∫–æ—Å—Ç—å (–±–æ–ª–µ–µ —â–µ–¥—Ä—ã–µ, —á–µ–º –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
    const chances = {
        consumer: 0.25,      // 25% (–±—ã–ª–æ 40%)
        industrial: 0.28,    // 28% (–±—ã–ª–æ 30%)
        'mil-spec': 0.25,    // 25% (–±—ã–ª–æ 18%)
        restricted: 0.12,    // 12% (–±—ã–ª–æ 8%)
        classified: 0.06,    // 6% (–±—ã–ª–æ 3%)
        covert: 0.025,       // 2.5% (–±—ã–ª–æ 0.64%)
        rare: 0.015          // 1.5% (–±—ã–ª–æ 0.26%)
    };

    const random = Math.random();
    let cumulative = 0;
    let selectedRarity = 'consumer';

    for (const [rarity, chance] of Object.entries(chances)) {
        cumulative += chance;
        if (random < cumulative) {
            selectedRarity = rarity;
            break;
        }
    }

    // –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç –¥–∞–Ω–Ω–æ–π —Ä–µ–¥–∫–æ—Å—Ç–∏
    const itemsOfRarity = currentCase.items.filter(item => item.rarity === selectedRarity);
    
    if (itemsOfRarity.length === 0) {
        // –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–∞–Ω–Ω–æ–π —Ä–µ–¥–∫–æ—Å—Ç–∏, –±–µ—Ä—ë–º consumer
        const fallback = currentCase.items.filter(item => item.rarity === 'consumer');
        return fallback[Math.floor(Math.random() * fallback.length)];
    }

    return itemsOfRarity[Math.floor(Math.random() * itemsOfRarity.length)];
}

// –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ä—É–ª–µ—Ç–∫–∏
const ITEM_WIDTH = 160; // 150px —à–∏—Ä–∏–Ω–∞ + 10px –æ—Ç—Å—Ç—É–ø—ã
const TOTAL_ITEMS = 70; // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
const WIN_POSITION = 50; // –ü–æ–∑–∏—Ü–∏—è –≤—ã–∏–≥—Ä—ã—à–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞

function generateRoulette() {
    const track = document.getElementById('rouletteTrack');
    track.innerHTML = '';
    track.style.transition = 'none';
    track.style.transform = 'translateY(-50%) translateX(0px)';

    for (let i = 0; i < TOTAL_ITEMS; i++) {
        let item;
        if (i === WIN_POSITION) {
            item = wonItem;
        } else {
            // –°–ª—É—á–∞–π–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç —Å —É—á—ë—Ç–æ–º —à–∞–Ω—Å–æ–≤
            item = getRandomItemForRoulette();
        }

        const div = document.createElement('div');
        div.className = `roulette-item ${item.rarity}`;
        if (i === WIN_POSITION) {
            div.setAttribute('data-winner', 'true');
        }
        div.innerHTML = `
            <img src="${item.image}" alt="${item.name}">
            <span>${item.name}</span>
        `;
        track.appendChild(div);
    }
}

function getRandomItemForRoulette() {
    // –í–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
    const random = Math.random();
    let selectedRarity;
    
    if (random < 0.35) selectedRarity = 'consumer';
    else if (random < 0.60) selectedRarity = 'industrial';
    else if (random < 0.80) selectedRarity = 'mil-spec';
    else if (random < 0.92) selectedRarity = 'restricted';
    else if (random < 0.97) selectedRarity = 'classified';
    else if (random < 0.995) selectedRarity = 'covert';
    else selectedRarity = 'rare';

    const items = currentCase.items.filter(item => item.rarity === selectedRarity);
    if (items.length === 0) {
        return currentCase.items[Math.floor(Math.random() * currentCase.items.length)];
    }
    return items[Math.floor(Math.random() * items.length)];
}

function spinRoulette() {
    const track = document.getElementById('rouletteTrack');
    const container = document.getElementById('rouletteContainer');
    const containerWidth = container.offsetWidth;
    
    // –í—ã—á–∏—Å–ª—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –¥–æ —Ü–µ–Ω—Ç—Ä–∞ –≤—ã–∏–≥—Ä—ã—à–Ω–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
    // –¶–µ–Ω—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ - —ç—Ç–æ containerWidth / 2
    // –¶–µ–Ω—Ç—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ –Ω–∞ –ø–æ–∑–∏—Ü–∏–∏ WIN_POSITION = WIN_POSITION * ITEM_WIDTH + ITEM_WIDTH / 2
    const itemCenter = WIN_POSITION * ITEM_WIDTH + ITEM_WIDTH / 2;
    const containerCenter = containerWidth / 2;
    
    // –°–º–µ—â–µ–Ω–∏–µ —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä –ø—Ä–µ–¥–º–µ—Ç–∞ –±—ã–ª –≤ —Ü–µ–Ω—Ç—Ä–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à–æ–µ —Å–ª—É—á–∞–π–Ω–æ–µ —Å–º–µ—â–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –ø—Ä–µ–¥–º–µ—Ç–∞ (–Ω–æ –Ω–µ –≤—ã—Ö–æ–¥—è –∑–∞ –µ–≥–æ –≥—Ä–∞–Ω–∏—Ü—ã)
    const randomOffset = (Math.random() - 0.5) * (ITEM_WIDTH * 0.6); // ¬±48px –º–∞–∫—Å–∏–º—É–º
    const targetOffset = itemCenter - containerCenter + randomOffset;

    // –ü—Ä–∏–º–µ–Ω—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    track.style.transition = 'transform 5s cubic-bezier(0.15, 0.8, 0.3, 1)';
    track.style.transform = `translateY(-50%) translateX(-${targetOffset}px)`;

    // –ü–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
        stopSpinSound();
        isSpinning = false;
        showWinResult();
    }, 5200);
}

function showWinResult() {
    document.getElementById('rouletteContainer').classList.remove('show');
    
    const winDisplay = document.getElementById('winDisplay');
    const winGlow = document.getElementById('winGlow');
    const currency = currencies[currentCurrency];
    
    document.getElementById('winImage').src = wonItem.image;
    document.getElementById('winName').textContent = wonItem.name;
    document.getElementById('winPrice').textContent = formatPriceNumber(wonItem.price);
    document.getElementById('winCurrencySymbol').textContent = currency.symbol;
    
    winGlow.className = `win-glow ${wonItem.rarity}`;
    
    winDisplay.classList.add('show');
    document.getElementById('openCaseBtn').style.display = 'none';

    // –ó–≤—É–∫ –ø–æ–±–µ–¥—ã
    if (wonItem.rarity === 'rare' || wonItem.rarity === 'covert') {
        playSound('rareWin');
    } else {
        playSound('win');
    }
}

function keepItem() {
    if (!wonItem) return;
    
    inventory.push({...wonItem, id: Date.now()});
    saveData();
    updateInventory();
    
    showNotification(`${wonItem.name} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å!`, 'success');
    playSound('sell');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    wonItem = null;
    document.getElementById('caseModal').classList.remove('show');
    currentCase = null;
}

function sellWonItem() {
    if (!wonItem) return;
    
    balance += wonItem.price;
    stats.itemsSold++;
    stats.moneyEarned += wonItem.price;
    
    updateBalance();
    saveData();
    updateStats(); // –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É
    
    showNotification(`–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ${formatPrice(wonItem.price)}`, 'success');
    playSound('sell');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    wonItem = null;
    document.getElementById('caseModal').classList.remove('show');
    currentCase = null;
}

// ==================== –ò–ù–í–ï–ù–¢–ê–†–¨ ====================

function sellItem(index) {
    const item = inventory[index];
    if (!item) return;

    balance += item.price;
    stats.itemsSold++;
    stats.moneyEarned += item.price;
    inventory.splice(index, 1);
    
    updateBalance();
    saveData();
    renderInventory();
    
    showNotification(`–ü—Ä–æ–¥–∞–Ω–æ –∑–∞ ${formatPrice(item.price)}`, 'success');
    playSound('sell');
}

function sellAll() {
    if (inventory.length === 0) {
        showNotification('–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç!', 'error');
        return;
    }

    const total = inventory.reduce((sum, item) => sum + item.price, 0);
    const count = inventory.length;
    balance += total;
    stats.itemsSold += count;
    stats.moneyEarned += total;
    inventory = [];
    
    updateBalance();
    saveData();
    renderInventory();
    
    showNotification(`–ü—Ä–æ–¥–∞–Ω–æ ${count} –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –∑–∞ ${formatPrice(total)}`, 'success');
    playSound('sell');
}

function updateInventory() {
    document.getElementById('inventoryCount').textContent = inventory.length;
}

// ==================== –ë–ê–õ–ê–ù–° ====================

function updateBalance() {
    document.getElementById('balance').textContent = formatPriceNumber(balance);
}

function addBalance() {
    const amountToAddUSD = 2.3;
    balance += amountToAddUSD;
    updateBalance();
    saveData();
    showNotification(`+${formatPrice(amountToAddUSD)} –¥–æ–±–∞–≤–ª–µ–Ω–æ!`, 'success');
    playSound('sell');
}

// ==================== –ó–í–£–ö–ò (Web Audio API) ====================

let audioContext = null;
const soundBuffers = {};

function initAudio() {
    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        generateAllSounds();
    }
}

function generateAllSounds() {
    // Click sound
    soundBuffers.click = generateClickSound();
    // Spin/tick sound
    soundBuffers.spin = generateSpinSound();
    // Win sound
    soundBuffers.win = generateWinSound();
    // Rare win sound
    soundBuffers.rareWin = generateRareWinSound();
    // Sell sound
    soundBuffers.sell = generateSellSound();
}

function generateClickSound() {
    const duration = 0.08;
    const buffer = audioContext.createBuffer(1, audioContext.sampleRate * duration, audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < buffer.length; i++) {
        const t = i / audioContext.sampleRate;
        data[i] = (Math.random() * 2 - 1) * Math.exp(-t * 50);
    }
    return buffer;
}

function generateSpinSound() {
    const duration = 0.06;
    const buffer = audioContext.createBuffer(1, audioContext.sampleRate * duration, audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < buffer.length; i++) {
        const t = i / audioContext.sampleRate;
        data[i] = Math.sin(2 * Math.PI * 1200 * t) * Math.exp(-t * 40);
    }
    return buffer;
}

function generateWinSound() {
    const duration = 1.2;
    const buffer = audioContext.createBuffer(1, audioContext.sampleRate * duration, audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < buffer.length; i++) {
        const t = i / audioContext.sampleRate;
        // –ú–∞–∂–æ—Ä–Ω—ã–π –∞–∫–∫–æ—Ä–¥ (C E G)
        data[i] = (
            Math.sin(2 * Math.PI * 523.25 * t) * 0.4 +
            Math.sin(2 * Math.PI * 659.25 * t) * 0.3 +
            Math.sin(2 * Math.PI * 783.99 * t) * 0.3
        ) * Math.exp(-t * 1.5);
    }
    return buffer;
}

function generateRareWinSound() {
    const duration = 2.0;
    const buffer = audioContext.createBuffer(1, audioContext.sampleRate * duration, audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < buffer.length; i++) {
        const t = i / audioContext.sampleRate;
        // –≠–ø–∏—á–µ—Å–∫–∏–π –∞–∫–∫–æ—Ä–¥ —Å –≥–∞—Ä–º–æ–Ω–∏–∫–∞–º–∏
        const freq1 = 261.63; // C4
        const freq2 = 329.63; // E4
        const freq3 = 392.00; // G4
        const freq4 = 523.25; // C5
        
        data[i] = (
            Math.sin(2 * Math.PI * freq1 * t) * 0.25 +
            Math.sin(2 * Math.PI * freq2 * t) * 0.25 +
            Math.sin(2 * Math.PI * freq3 * t) * 0.25 +
            Math.sin(2 * Math.PI * freq4 * t) * 0.25 +
            Math.sin(2 * Math.PI * freq4 * 2 * t) * 0.1
        ) * Math.exp(-t * 0.8) * (1 + Math.sin(t * 10) * 0.1);
    }
    return buffer;
}

function generateSellSound() {
    const duration = 0.4;
    const buffer = audioContext.createBuffer(1, audioContext.sampleRate * duration, audioContext.sampleRate);
    const data = buffer.getChannelData(0);
    
    for (let i = 0; i < buffer.length; i++) {
        const t = i / audioContext.sampleRate;
        // –ó–≤—É–∫ –º–æ–Ω–µ—Ç
        data[i] = (
            Math.sin(2 * Math.PI * 2000 * t) * 0.3 +
            Math.sin(2 * Math.PI * 3000 * t) * 0.2 +
            Math.sin(2 * Math.PI * 4000 * t) * 0.1 +
            (Math.random() * 2 - 1) * 0.1
        ) * Math.exp(-t * 8);
    }
    return buffer;
}

function initSoundToggle() {
    updateSoundIcon();
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É–¥–∏–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏
    document.addEventListener('click', () => {
        if (!audioContext) initAudio();
    }, { once: true });
}

function toggleSound() {
    soundEnabled = !soundEnabled;
    localStorage.setItem('cs2_sound', soundEnabled);
    updateSoundIcon();
    
    if (soundEnabled) {
        initAudio();
        playSound('click');
    }
}

function updateSoundIcon() {
    document.getElementById('soundIcon').textContent = soundEnabled ? 'üîä' : 'üîá';
}

function playSound(type) {
    if (!soundEnabled || !audioContext) return;

    const buffer = soundBuffers[type];
    if (!buffer) return;

    const source = audioContext.createBufferSource();
    const gainNode = audioContext.createGain();
    
    source.buffer = buffer;
    source.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    // –ì—Ä–æ–º–∫–æ—Å—Ç—å
    const volumes = {
        click: 0.3,
        spin: 0.4,
        win: 0.5,
        rareWin: 0.6,
        sell: 0.4
    };
    
    gainNode.gain.value = volumes[type] || 0.5;
    source.start(0);
}

// –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–≤—É–∫–∞ —Ä—É–ª–µ—Ç–∫–∏ (—Ç–∏–∫–∞—é—â–∏–π –∑–≤—É–∫)
let spinInterval = null;

function startSpinSound() {
    if (!soundEnabled || !audioContext) return;
    
    let delay = 50;
    const maxDelay = 300;
    const increment = 5;
    
    function tick() {
        playSound('spin');
        delay = Math.min(delay + increment, maxDelay);
        spinInterval = setTimeout(tick, delay);
    }
    
    tick();
}

function stopSpinSound() {
    if (spinInterval) {
        clearTimeout(spinInterval);
        spinInterval = null;
    }
}

// ==================== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø ====================

function showNotification(message, type = 'info') {
    const container = document.getElementById('notifications');
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span>
        <span>${message}</span>
    `;
    container.appendChild(notification);

    setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateX(100px)';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// ==================== –°–û–•–†–ê–ù–ï–ù–ò–ï ====================

function saveData() {
    localStorage.setItem('cs2_balance', balance.toString());
    localStorage.setItem('cs2_inventory', JSON.stringify(inventory));
    localStorage.setItem('cs2_stats', JSON.stringify(stats));
}

// ==================== –°–¢–ê–¢–ò–°–¢–ò–ö–ê ====================

function updateStats() {
    const totalDrops = Object.values(stats.rarityDrops).reduce((a, b) => a + b, 0);
    const inventoryValue = inventory.reduce((sum, item) => sum + item.price, 0);
    const profit = stats.moneyEarned + inventoryValue - stats.moneySpent;
    
    document.getElementById('statCasesOpened').textContent = stats.casesOpened;
    document.getElementById('statMoneySpent').textContent = formatPrice(stats.moneySpent);
    document.getElementById('statItemsSold').textContent = stats.itemsSold;
    document.getElementById('statMoneyEarned').textContent = formatPrice(stats.moneyEarned);
    document.getElementById('statItemsKept').textContent = inventory.length;
    
    const profitEl = document.getElementById('statProfit');
    profitEl.textContent = (profit >= 0 ? '+' : '') + formatPrice(profit);
    profitEl.style.color = profit >= 0 ? '#4CAF50' : '#f44336';
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª–æ—Å–∫–∏ —Ä–µ–¥–∫–æ—Å—Ç–∏
    const rarities = ['consumer', 'industrial', 'mil-spec', 'restricted', 'classified', 'covert', 'rare'];
    const maxDrops = Math.max(...Object.values(stats.rarityDrops), 1);
    
    rarities.forEach(rarity => {
        const count = stats.rarityDrops[rarity] || 0;
        const percentage = (count / maxDrops) * 100;
        const fillId = 'rarity' + rarity.charAt(0).toUpperCase() + rarity.slice(1).replace('-', '');
        const fillEl = document.getElementById(fillId);
        if (fillEl) {
            fillEl.style.width = percentage + '%';
        }
        
        const countId = 'count' + rarity.charAt(0).toUpperCase() + rarity.slice(1).replace('-', '');
        const countEl = document.getElementById(countId);
        if (countEl) {
            countEl.textContent = count;
        }
    });
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ ID –¥–ª—è mil-spec
    const milSpecFill = document.getElementById('rarityMilSpec');
    if (milSpecFill) {
        milSpecFill.style.width = ((stats.rarityDrops['mil-spec'] || 0) / maxDrops * 100) + '%';
    }
    document.getElementById('countMilSpec').textContent = stats.rarityDrops['mil-spec'] || 0;
}

function resetStats() {
    if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É?')) {
        stats = {
            casesOpened: 0,
            moneySpent: 0,
            itemsSold: 0,
            moneyEarned: 0,
            rarityDrops: {
                consumer: 0,
                industrial: 0,
                'mil-spec': 0,
                restricted: 0,
                classified: 0,
                covert: 0,
                rare: 0
            }
        };
        saveData();
        updateStats();
        showNotification('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞!', 'success');
        playSound('click');
    }
}

// ==================== –ó–ê–ö–†–´–¢–ò–ï –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê –ü–û ESC ====================

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeModal();
    }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
document.getElementById('caseModal').addEventListener('click', (e) => {
    if (e.target.id === 'caseModal') {
        closeModal();
    }
});



